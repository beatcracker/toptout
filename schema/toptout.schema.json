{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$ref": "#/definitions/Toptout",
    "definitions": {
        "Toptout": {
            "title": "Toptout",
            "description": "Toptout data file schema. Describes application telemetry channels.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^[a-z0-9-]+$",
                    "description": "Product unique ID. Use [a-z0-9-] character set. Must be unique across all files. Example: foo-bar."
                },
                "name": {
                    "type": "string",
                    "pattern": "^[\\S]+(\\s+[\\S]+)*$",
                    "description": "Friendly name of the product. No leading/trailing whitespace allowed. Example: Foo Bar."
                },
                "executable_name": {
                    "type": "array",
                    "description": "Optional. Provide executable name(s) if presence of this product can be detected by PATH environment variable lookup. No leading/trailing whitespace allowed.",
                    "items": {
                        "type": "string",
                        "pattern": "^[\\S]+(\\s+[\\S]+)*$"
                    }
                },
                "description": {
                    "type": "string",
                    "pattern": "^[\\S]+(\\s+[\\S]+)*$",
                    "description": "Short description of the collected telemetry. Usually copied from the product's documentation. No leading/trailing whitespace allowed."
                },
                "category_id": {
                    "type": "string",
                    "pattern": "^[a-z0-9-]+$",
                    "description": "Unique category id. Use [a-z0-9-] character set. The API generator uses it to group products. Example: development."
                },
                "category_name": {
                    "type": "string",
                    "pattern": "^[\\S]+(\\s+[\\S]+)*$",
                    "description": "Friendly category name. The README generator uses it to group products. No leading/trailing whitespace allowed. Example: Development."
                },
                "links": {
                    "$ref": "#/definitions/Links"
                },
                "telemetry": {
                    "type": "array",
                    "description": "Telemetry channels list. Contains name and optionally description and opt-in/out methods. Optional, since you may wish to add a product that contains telemetry but doesn't provide a way to control it.",
                    "items": {
                        "$ref": "#/definitions/Telemetry"
                    }
                }
            },
            "required": [
                "description",
                "category_id",
                "category_name",
                "id",
                "links",
                "name"
            ]
        },
        "Links": {
            "title": "Links",
            "description": "Contains links to the main product page, telemetry and privacy policy.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "main": {
                    "type": "string",
                    "format": "uri",
                    "pattern": "^http[s]?:\\/\\/.+$",
                    "description": "Link to the product's website. Mandatory."
                },
                "telemetry": {
                    "type": "string",
                    "format": "uri",
                    "pattern": "^http[s]?:\\/\\/.+$",
                    "description": "Link to the product's general telemetry description. Optional."
                },
                "privacy": {
                    "type": "string",
                    "format": "uri",
                    "pattern": "^http[s]?:\\/\\/.+$",
                    "description": "Link to the product's privacy policy. Optional."
                }
            },
            "required": [
                "main"
            ]
        },
        "Telemetry": {
            "title": "Telemetry",
            "description": "Describes single telemetry channel (version check, analytics, etc..).",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^[a-z0-9-]+$",
                    "description": "Telemetry channel unique ID. Use [a-z0-9-] character set. Must be unique in this array. Example: usage-data."
                },
                "name": {
                    "type": "string",
                    "pattern": "^[\\S]+(\\s+[\\S]+)*$",
                    "description": "Friendly name of the channel. No leading/trailing whitespace allowed. Example: Usage data."
                },
                "traits": {
                    "$ref": "#/definitions/Traits"
                },
                "description": {
                    "type": "string",
                    "pattern": "^[\\S]+(\\s+[\\S]+)*$",
                    "description": "Optional description. Example: Disable usage data reporting."
                },
                "links": {
                    "$ref": "#/definitions/Links"
                },
                "target": {
                    "$ref": "#/definitions/Target"
                }
            },
            "required": [
                "id",
                "name",
                "traits"
            ]
        },
        "Target": {
            "title": "Target",
            "description": "Describes telemetry channel configuration options. Optional, since you may wish to describe telemetry channels that don't provide a ways to control them.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "exec": {
                    "$ref": "#/definitions/Exec"
                },
                "env": {
                    "$ref": "#/definitions/Env"
                },
                "plain_file": {
                    "$ref": "#/definitions/PlainFile"
                },
                "json_file": {
                    "$ref": "#/definitions/JSONFile"
                },
                "registry": {
                    "$ref": "#/definitions/Registry"
                },
                "noop": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/Noop"
                    }
                }
            },
            "anyOf": [
                {
                    "required": [
                        "exec"
                    ]
                },
                {
                    "required": [
                        "env"
                    ]
                },
                {
                    "required": [
                        "plain_file"
                    ]
                },
                {
                    "required": [
                        "json_file"
                    ]
                },
                {
                    "required": [
                        "registry"
                    ]
                },
                {
                    "required": [
                        "noop"
                    ]
                }
            ]
        },
        "Env": {
            "title": "Env",
            "description": "\"Environment variable\" target. Set or remove environment variable. Environment variables are by design configured in process scope. There are mechanisms to configure them for every new process, but it's up to OS/shell.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "scope": {
                    "type": "object",
                    "description": "Target scope. You can use multiple scopes: machine (applies to all users of the computer), user (applies to current user of the computer), process (applies to current process only).",
                    "additionalProperties": false,
                    "properties": {
                        "machine": {
                            "$ref": "#/definitions/EnvProperties",
                            "description": "Configures telemetry channel for all users of the computer."
                        },
                        "user": {
                            "$ref": "#/definitions/EnvProperties",
                            "description": "Configures telemetry channel for current user of the computer."
                        },
                        "process": {
                            "$ref": "#/definitions/EnvProperties",
                            "description": "Configures telemetry channel for process only."
                        }
                    },
                    "anyOf": [
                        {
                            "required": [
                                "machine"
                            ]
                        },
                        {
                            "required": [
                                "process"
                            ]
                        },
                        {
                            "required": [
                                "user"
                            ]
                        }
                    ]
                }
            },
            "required": [
                "scope"
            ]
        },
        "EnvProperties": {
            "title": "EnvProperties",
            "description": "Describe variable name and applicable values",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "path": {
                    "$ref": "#/definitions/Path"
                },
                "value": {
                    "$ref": "#/definitions/StringValue"
                }
            },
            "required": [
                "path",
                "value"
            ]
        },
        "Exec": {
            "title": "Exec",
            "description": "\"Execute command\". Run command with arguments.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "scope": {
                    "type": "object",
                    "description": "Target scope. You can use multiple scopes: machine (applies to all users of the computer), user (applies to current user of the computer), process (applies to current process only).",
                    "additionalProperties": false,
                    "properties": {
                        "machine": {
                            "$ref": "#/definitions/ExecProperties",
                            "description": "Configures telemetry channel for all users of the computer."
                        },
                        "user": {
                            "$ref": "#/definitions/ExecProperties",
                            "description": "Configures telemetry channel for current user of the computer."
                        },
                        "process": {
                            "$ref": "#/definitions/ExecProperties",
                            "description": "Configures telemetry channel for process only."
                        }
                    },
                    "anyOf": [
                        {
                            "required": [
                                "machine"
                            ]
                        },
                        {
                            "required": [
                                "process"
                            ]
                        },
                        {
                            "required": [
                                "user"
                            ]
                        }
                    ]
                }
            },
            "required": [
                "scope"
            ]
        },
        "ExecProperties": {
            "title": "ExecProperties",
            "description": "Describes command name and arguments.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "path": {
                    "$ref": "#/definitions/Path"
                },
                "value": {
                    "$ref": "#/definitions/StringValue"
                }
            },
            "required": [
                "path",
                "value"
            ]
        },
        "JSONFile": {
            "title": "JSONFile",
            "description": "\"JSON file\". Modify JSON file.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "scope": {
                    "type": "object",
                    "description": "Target scope. You can use multiple scopes: machine (applies to all users of the computer), user (applies to current user of the computer), process (applies to current process only).",
                    "additionalProperties": false,
                    "properties": {
                        "machine": {
                            "$ref": "#/definitions/JSONFileProperties",
                            "description": "Configures telemetry channel for all users of the computer."
                        },
                        "user": {
                            "$ref": "#/definitions/JSONFileProperties",
                            "description": "Configures telemetry channel for current user of the computer."
                        },
                        "process": {
                            "$ref": "#/definitions/JSONFileProperties",
                            "description": "Configures telemetry channel for process only."
                        }
                    },
                    "anyOf": [
                        {
                            "required": [
                                "machine"
                            ]
                        },
                        {
                            "required": [
                                "process"
                            ]
                        },
                        {
                            "required": [
                                "user"
                            ]
                        }
                    ]
                }
            },
            "required": [
                "scope"
            ]
        },
        "JSONFileProperties": {
            "title": "JSONFileProperties",
            "description": "Describes file path, selector for target property and values.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "path": {
                    "$ref": "#/definitions/Path"
                },
                "selector": {
                    "type": "string"
                },
                "value": {
                    "$ref": "#/definitions/RichValue"
                },
                "display_value": {
                    "type": "string"
                }
            },
            "required": [
                "display_value",
                "path",
                "selector",
                "value"
            ]
        },
        "PlainFile": {
            "title": "PlainFile",
            "description": "\"Plaintext file\". Modify plaintext file.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "scope": {
                    "type": "object",
                    "description": "Target scope. You can use multiple scopes: machine (applies to all users of the computer), user (applies to current user of the computer), process (applies to current process only).",
                    "additionalProperties": false,
                    "properties": {
                        "machine": {
                            "$ref": "#/definitions/PlainFileProperties",
                            "description": "Configures telemetry channel for all users of the computer."
                        },
                        "user": {
                            "$ref": "#/definitions/PlainFileProperties",
                            "description": "Configures telemetry channel for current user of the computer."
                        },
                        "process": {
                            "$ref": "#/definitions/PlainFileProperties",
                            "description": "Configures telemetry channel for process only."
                        }
                    },
                    "anyOf": [
                        {
                            "required": [
                                "machine"
                            ]
                        },
                        {
                            "required": [
                                "process"
                            ]
                        },
                        {
                            "required": [
                                "user"
                            ]
                        }
                    ]
                }
            },
            "required": [
                "scope"
            ]
        },
        "PlainFileProperties": {
            "title": "PlainFileProperties",
            "description": "Describes file path, selector for target property and values.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "path": {
                    "$ref": "#/definitions/Path"
                },
                "selector": {
                    "type": "string"
                },
                "value": {
                    "$ref": "#/definitions/StringValue"
                },
                "display_value": {
                    "type": "string"
                }
            },
            "required": [
                "display_value",
                "path",
                "selector",
                "value"
            ]
        },
        "Registry": {
            "title": "Registry",
            "description": "\"Windows registry\". Modify keys/values in Windows registry.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "scope": {
                    "type": "object",
                    "description": "Target scope. You can use multiple scopes: machine (applies to all users of the computer), user (applies to current user of the computer), process (applies to current process only).",
                    "additionalProperties": false,
                    "properties": {
                        "machine": {
                            "$ref": "#/definitions/RegistryProperties",
                            "description": "Configures telemetry channel for all users of the computer."
                        },
                        "user": {
                            "$ref": "#/definitions/RegistryProperties",
                            "description": "Configures telemetry channel for current user of the computer."
                        },
                        "process": {
                            "$ref": "#/definitions/RegistryProperties",
                            "description": "Configures telemetry channel for process only."
                        }
                    },
                    "anyOf": [
                        {
                            "required": [
                                "machine"
                            ]
                        },
                        {
                            "required": [
                                "process"
                            ]
                        },
                        {
                            "required": [
                                "user"
                            ]
                        }
                    ]
                }
            },
            "required": [
                "scope"
            ]
        },
        "RegistryProperties": {
            "title": "RegistryProperties",
            "description": "Describes registry path and keys/values.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "root": {
                    "type": "string",
                    "description": "Registry hive name: https://docs.microsoft.com/en-us/windows/win32/sysinfo/predefined-keys",
                    "enum": [
                        "HKEY_CLASSES_ROOT",
                        "HKEY_CURRENT_CONFIG",
                        "HKEY_CURRENT_USER",
                        "HKEY_CURRENT_USER_LOCAL_SETTINGS",
                        "HKEY_LOCAL_MACHINE",
                        "HKEY_PERFORMANCE_DATA",
                        "HKEY_PERFORMANCE_NLSTEXT",
                        "HKEY_PERFORMANCE_TEXT",
                        "HKEY_USERS"
                    ]
                },
                "path": {
                    "type": "string",
                    "description": "Registry key path.",
                    "pattern": "^(?!\\\\).+?(?<!\\\\)$"
                },
                "key": {
                    "type": "string",
                    "description": "Registry key name."
                },
                "type": {
                    "type": "string",
                    "description": "Registry key type.",
                    "enum": [
                        "REG_SZ",
                        "REG_EXPAND_SZ",
                        "REG_MULTI_SZ",
                        "REG_DWORD_BIG_ENDIAN",
                        "REG_DWORD",
                        "REG_QWORD",
                        "REG_BINARY"
                    ]
                },
                "value": {
                    "$ref": "#/definitions/StringValue"
                }
            },
            "required": [
                "root",
                "path",
                "key",
                "type",
                "value"
            ]
        },
        "Noop": {
            "title": "Noop",
            "description": "\"No operation\". Use this for links to third-party telemetry configuration tools, that are not supported by this schema.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "name": {
                    "type": "string",
                    "pattern": "^[\\S]+(\\s+[\\S]+)*$",
                    "description": "Friendly name. No leading/trailing whitespace allowed."
                },
                "link": {
                    "type": "string",
                    "format": "uri",
                    "pattern": "^http[s]?:\\/\\/.+$",
                    "description": "Link to website. Example: https://example.com."
                },
                "description": {
                    "type": "string",
                    "pattern": "^[\\S]+(\\s+[\\S]+)*$",
                    "description": "Friendly description. No leading/trailing whitespace allowed."
                }
            },
            "required": [
                "description",
                "link",
                "name"
            ]
        },
        "Path": {
            "title": "Path",
            "description": "Item path. For environment variables this would be name, for files - full path.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "linux": {
                    "type": "string",
                    "description": "This path should be used on Linux."
                },
                "macos": {
                    "type": "string",
                    "description": "This path should be used on macOS."
                },
                "windows": {
                    "type": "string",
                    "description": "This path should be used on Windows."
                },
                "default": {
                    "type": "string",
                    "description": "if no OS-specific path is specified, this one should be used."
                }
            },
            "anyOf": [
                {
                    "required": [
                        "default"
                    ]
                },
                {
                    "required": [
                        "linux"
                    ]
                },
                {
                    "required": [
                        "macos"
                    ]
                },
                {
                    "required": [
                        "windows"
                    ]
                }
            ]
        },
        "StringValue": {
            "title": "StringValue",
            "description": "Opt-in/out values for env/exec/plain_file/registry targets",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "opt_out": {
                    "description": "This value will opt-OUT of the telemetry collection. Use null to indicate that entry should be removed.",
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "opt_in": {
                    "description": "This value will opt-IN of the telemetry collection. Use null to indicate that value should be removed.",
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "null"
                        }
                    ]
                }
            },
            "required": [
                "opt_in",
                "opt_out"
            ]
        },
        "RichValue": {
            "title": "RichValue",
            "description": "Opt-in/out values for JSON and other targets that can use non-string values (e.g.: number/boolean)",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "opt_out": {
                    "description": "This value will opt-OUT of the telemetry collection. Use null to indicate that the entire key holding this value should be removed.",
                    "oneOf": [
                        {
                            "type": "number"
                        },
                        {
                            "type": "string"
                        },
                        {
                            "type": "boolean"
                        },
                        {
                            "type": "null"
                        }
                    ]
                },
                "opt_in": {
                    "description": "This value will opt-IN to the telemetry collection. Use null to indicate that value should be removed.",
                    "oneOf": [
                        {
                            "type": "number"
                        },
                        {
                            "type": "string"
                        },
                        {
                            "type": "boolean"
                        },
                        {
                            "type": "null"
                        }
                    ]
                }
            },
            "required": [
                "opt_in",
                "opt_out"
            ]
        },
        "Traits": {
            "title": "Traits",
            "description": "Describes telemetry channel traits",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "official": {
                    "type": "boolean",
                    "description": "Telemetry channel officially supports opt-in/opt-out."
                },
                "usage_data": {
                    "type": "boolean",
                    "description": "Telemetry channel provides usage data."
                },
                "update_check": {
                    "type": "boolean",
                    "description": "Telemetry channel provides update checks."
                },
                "error_report": {
                    "type": "boolean",
                    "description": "Telemetry channel provides error reports."
                }
            },
            "required": [
                "official",
                "usage_data",
                "update_check",
                "error_report"
            ]
        }
    }
}